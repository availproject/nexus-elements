{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "nexus-provider",
  "type": "registry:component",
  "title": "Nexus Provider",
  "description": "Shared Nexus SDK provider and types for Nexus Elements",
  "dependencies": [
    "@avail-project/nexus-core@1.0.0-beta.56"
  ],
  "files": [
    {
      "path": "registry/nexus-elements/nexus/NexusProvider.tsx",
      "content": "\"use client\";\nimport {\n  type EthereumProvider,\n  type NexusNetwork,\n  NexusSDK,\n  type OnAllowanceHookData,\n  type OnIntentHookData,\n  type OnSwapIntentHookData,\n  type SupportedChainsAndTokensResult,\n  type SupportedChainsResult,\n  type UserAsset,\n} from \"@avail-project/nexus-core\";\n\nimport {\n  createContext,\n  type RefObject,\n  useCallback,\n  useContext,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { useAccountEffect } from \"wagmi\";\n\ninterface NexusContextType {\n  nexusSDK: NexusSDK | null;\n  bridgableBalance: UserAsset[] | null;\n  swapBalance: UserAsset[] | null;\n  intent: RefObject<OnIntentHookData | null>;\n  allowance: RefObject<OnAllowanceHookData | null>;\n  swapIntent: RefObject<OnSwapIntentHookData | null>;\n  exchangeRate: Record<string, number> | null;\n  supportedChainsAndTokens: SupportedChainsAndTokensResult | null;\n  swapSupportedChainsAndTokens: SupportedChainsResult | null;\n  network?: NexusNetwork;\n  loading: boolean;\n  handleInit: (provider: EthereumProvider) => Promise<void>;\n  fetchBridgableBalance: () => Promise<void>;\n  fetchSwapBalance: () => Promise<void>;\n  getFiatValue: (amount: number, token: string) => number;\n  initializeNexus: (provider: EthereumProvider) => Promise<void>;\n  deinitializeNexus: () => Promise<void>;\n  attachEventHooks: () => void;\n}\n\nconst NexusContext = createContext<NexusContextType | undefined>(undefined);\n\ntype NexusProviderProps = {\n  children: React.ReactNode;\n  config?: {\n    network?: NexusNetwork;\n    debug?: boolean;\n  };\n};\n\nconst defaultConfig: Required<NexusProviderProps[\"config\"]> = {\n  network: \"mainnet\",\n  debug: false,\n};\n\nconst NexusProvider = ({\n  children,\n  config = defaultConfig,\n}: NexusProviderProps) => {\n  const stableConfig = useMemo(\n    () => ({ ...defaultConfig, ...config }),\n    [config]\n  );\n\n  const sdkRef = useRef<NexusSDK | null>(null);\n  sdkRef.current ??= new NexusSDK({\n    ...stableConfig,\n  });\n  const sdk = sdkRef.current;\n\n  const [nexusSDK, setNexusSDK] = useState<NexusSDK | null>(null);\n  const [loading, setLoading] = useState<boolean>(false);\n  const supportedChainsAndTokens =\n    useRef<SupportedChainsAndTokensResult | null>(null);\n  const swapSupportedChainsAndTokens = useRef<SupportedChainsResult | null>(\n    null\n  );\n  const bridgableBalance = useRef<UserAsset[] | null>(null);\n  const [swapBalance, setSwapBalance] = useState<UserAsset[] | null>(null);\n  const exchangeRate = useRef<Record<string, number> | null>(null);\n\n  const intent = useRef<OnIntentHookData | null>(null);\n  const allowance = useRef<OnAllowanceHookData | null>(null);\n  const swapIntent = useRef<OnSwapIntentHookData | null>(null);\n\n  const setupNexus = useCallback(async () => {\n    const list = sdk.utils.getSupportedChains(\n      config?.network === \"testnet\" ? 0 : undefined\n    );\n    supportedChainsAndTokens.current = list ?? null;\n    const swapList = sdk.utils.getSwapSupportedChainsAndTokens();\n    swapSupportedChainsAndTokens.current = swapList ?? null;\n    const [bridgeAbleBalanceResult, rates] = await Promise.allSettled([\n      sdk.getBalancesForBridge(),\n      sdk.utils.getCoinbaseRates(),\n    ]);\n\n    if (bridgeAbleBalanceResult.status === \"fulfilled\") {\n      bridgableBalance.current = bridgeAbleBalanceResult.value;\n    }\n\n    if (rates?.status === \"fulfilled\") {\n      // Coinbase returns \"units per USD\" (e.g., 1 USD = 0.00028 ETH).\n      // Convert to \"USD per unit\" (e.g., 1 ETH = ~$3514) for straightforward UI calculations.\n      const usdPerUnit: Record<string, number> = {};\n\n      for (const [symbol, value] of Object.entries(rates.value)) {\n        const unitsPerUsd = Number.parseFloat(String(value));\n        if (Number.isFinite(unitsPerUsd) && unitsPerUsd > 0) {\n          usdPerUnit[symbol.toUpperCase()] = 1 / unitsPerUsd;\n        }\n      }\n      exchangeRate.current = usdPerUnit;\n    }\n  }, [sdk, config?.network]);\n\n  const initializeNexus = async (provider: EthereumProvider) => {\n    setLoading(true);\n    try {\n      if (sdk.isInitialized()) throw new Error(\"Nexus is already initialized\");\n      await sdk.initialize(provider);\n      setNexusSDK(sdk);\n    } catch (error) {\n      console.error(\"Error initializing Nexus:\", error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const deinitializeNexus = async () => {\n    try {\n      if (!nexusSDK) throw new Error(\"Nexus is not initialized\");\n      await nexusSDK?.deinit();\n      setNexusSDK(null);\n      supportedChainsAndTokens.current = null;\n      swapSupportedChainsAndTokens.current = null;\n      bridgableBalance.current = null;\n      setSwapBalance(null);\n      exchangeRate.current = null;\n      intent.current = null;\n      swapIntent.current = null;\n      allowance.current = null;\n      setLoading(false);\n    } catch (error) {\n      console.error(\"Error deinitializing Nexus:\", error);\n    }\n  };\n\n  const attachEventHooks = () => {\n    sdk.setOnAllowanceHook((data: OnAllowanceHookData) => {\n      /**\n       * Useful when you want the user to select, min, max or a custom value\n       * Can use this to capture data and then show it on the UI\n       * @see - always call data.allow() to progress the flow, otherwise it will stay stuck here.\n       * const {allow, sources, deny} = data\n       * @example allow(['min', 'max', '0.5']), the array in allow function should match number of sources.\n       * You can skip setting this hook if you want, sdk will auto progress if this hook is not attached\n       */\n      allowance.current = data;\n    });\n\n    sdk.setOnIntentHook((data: OnIntentHookData) => {\n      /**\n       * Useful when you want to capture the intent, and display it on the UI (bridge, bridgeAndTransfer, bridgeAndExecute)\n       * const {allow, deny, intent, refresh} = data\n       * @see - always call data.allow() to progress the flow, otherwise it will stay stuck here.\n       * deny() to reject the intent\n       * refresh() to refresh the intent, best to call refresh in 15 second intervals\n       * data.intent -> details about the intent, useful when wanting to display info on UI\n       * You can skip setting this hook if you want, sdk will auto progress if this hook is not attached\n       */\n      intent.current = data;\n    });\n\n    sdk.setOnSwapIntentHook((data: OnSwapIntentHookData) => {\n      /**\n       * Same behaviour and function as setOnIntentHook, except this one is for swaps exclusively\n       */\n      swapIntent.current = data;\n    });\n  };\n\n  const handleInit = async (provider: EthereumProvider) => {\n    if (sdk.isInitialized() || loading) {\n      return;\n    }\n    if (!provider || typeof provider.request !== \"function\") {\n      throw new Error(\"Invalid EIP-1193 provider\");\n    }\n    await initializeNexus(provider);\n    await setupNexus();\n    attachEventHooks();\n  };\n\n  const fetchBridgableBalance = async () => {\n    try {\n      const updatedBalance = await sdk.getBalancesForBridge();\n      bridgableBalance.current = updatedBalance;\n    } catch (error) {\n      console.error(\"Error fetching bridgable balance:\", error);\n    }\n  };\n\n  const fetchSwapBalance = async () => {\n    try {\n      const updatedBalance = await sdk.getBalancesForSwap();\n      setSwapBalance(updatedBalance);\n    } catch (error) {\n      console.error(\"Error fetching swap balance:\", error);\n    }\n  };\n\n  function getFiatValue(amount: number, token: string) {\n    const key = token.toUpperCase();\n    const rate = exchangeRate.current?.[key] ?? 1;\n    return rate * amount;\n  }\n\n  useAccountEffect({\n    onDisconnect() {\n      deinitializeNexus();\n    },\n  });\n\n  const value = useMemo(\n    () => ({\n      nexusSDK,\n      initializeNexus,\n      deinitializeNexus,\n      attachEventHooks,\n      intent,\n      allowance,\n      handleInit,\n      supportedChainsAndTokens: supportedChainsAndTokens.current,\n      swapSupportedChainsAndTokens: swapSupportedChainsAndTokens.current,\n      bridgableBalance: bridgableBalance.current,\n      swapBalance: swapBalance,\n      network: config?.network,\n      loading,\n      fetchBridgableBalance,\n      fetchSwapBalance,\n      swapIntent,\n      exchangeRate: exchangeRate.current,\n      getFiatValue,\n    }),\n    [\n      nexusSDK,\n      initializeNexus,\n      deinitializeNexus,\n      attachEventHooks,\n      handleInit,\n      swapBalance,\n      config,\n      loading,\n      fetchBridgableBalance,\n      fetchSwapBalance,\n    ]\n  );\n  return (\n    <NexusContext.Provider value={value}>{children}</NexusContext.Provider>\n  );\n};\n\nexport function useNexus() {\n  const context = useContext(NexusContext);\n  if (!context) {\n    throw new Error(\"useNexus must be used within a NexusProvider\");\n  }\n  return context;\n}\n\nexport default NexusProvider;\n",
      "type": "registry:component",
      "target": "components/nexus/NexusProvider.tsx"
    }
  ]
}