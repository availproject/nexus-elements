{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "nexus-provider",
  "type": "registry:component",
  "title": "Nexus Provider",
  "description": "Shared Nexus SDK provider and types for Nexus Elements",
  "dependencies": [
    "@avail-project/nexus-core@1.0.0-beta.22"
  ],
  "files": [
    {
      "path": "registry/nexus-elements/nexus/NexusProvider.tsx",
      "content": "\"use client\";\nimport {\n  type EthereumProvider,\n  type NexusNetwork,\n  NexusSDK,\n  type OnAllowanceHookData,\n  type OnIntentHookData,\n  type OnSwapIntentHook,\n  type SupportedChainsResult,\n  type UserAsset,\n  type OnSwapIntentHookData,\n  NexusError,\n  ERROR_CODES,\n} from \"@avail-project/nexus-core\";\nimport {\n  createContext,\n  useCallback,\n  useContext,\n  useMemo,\n  useState,\n} from \"react\";\n\ninterface NexusContextType {\n  nexusSDK: NexusSDK | null;\n  unifiedBalance: UserAsset[] | null;\n  initializeNexus: (provider: EthereumProvider) => Promise<void>;\n  deinitializeNexus: () => Promise<void>;\n  attachEventHooks: () => void;\n  intent: OnIntentHookData | null;\n  exchangeRate: Record<string, number> | null;\n  swapIntent: OnSwapIntentHookData | null;\n  setSwapIntent: React.Dispatch<\n    React.SetStateAction<OnSwapIntentHookData | null>\n  >;\n  setIntent: React.Dispatch<React.SetStateAction<OnIntentHookData | null>>;\n  allowance: OnAllowanceHookData | null;\n  setAllowance: React.Dispatch<\n    React.SetStateAction<OnAllowanceHookData | null>\n  >;\n  handleInit: (provider: EthereumProvider) => Promise<void>;\n  supportedChainsAndTokens: SupportedChainsResult | null;\n  swapSupportedChainsAndTokens: SupportedChainsResult | null;\n  network?: NexusNetwork;\n  loading: boolean;\n  fetchUnifiedBalance: () => Promise<void>;\n  handleNexusError: (err: unknown) => {\n    code?: (typeof ERROR_CODES)[keyof typeof ERROR_CODES];\n    message: string;\n    context?: string;\n    details?: Record<string, unknown>;\n  };\n  getFiatValue: (amount: number, token: string) => string;\n}\n\nconst NexusContext = createContext<NexusContextType | undefined>(undefined);\nconst NexusProvider = ({\n  children,\n  config = {\n    network: \"mainnet\",\n    debug: true,\n  },\n}: {\n  children: React.ReactNode;\n  config?: {\n    network?: NexusNetwork;\n    debug?: boolean;\n  };\n}) => {\n  const sdk = useMemo(() => new NexusSDK(config), [config]);\n  const [nexusSDK, setNexusSDK] = useState<NexusSDK | null>(null);\n  const [supportedChainsAndTokens, setSupportedChainsAndTokens] =\n    useState<SupportedChainsResult | null>(null);\n  const [swapSupportedChainsAndTokens, setSwapSupportedChainsAndTokens] =\n    useState<SupportedChainsResult | null>(null);\n  const [unifiedBalance, setUnifiedBalance] = useState<UserAsset[] | null>(\n    null\n  );\n  const [exchangeRate, setExchangeRate] = useState<Record<\n    string,\n    number\n  > | null>(null);\n  const [loading, setLoading] = useState<boolean>(false);\n  const [intent, setIntent] = useState<OnIntentHookData | null>(null);\n  const [swapIntent, setSwapIntent] = useState<\n    Parameters<OnSwapIntentHook>[0] | null\n  >(null);\n  const [allowance, setAllowance] = useState<OnAllowanceHookData | null>(null);\n\n  const initChainsAndTokens = useCallback(() => {\n    const list = sdk?.utils?.getSupportedChains(\n      config?.network === \"testnet\" ? 0 : undefined\n    );\n    setSupportedChainsAndTokens(list ?? null);\n    const swapList = sdk?.utils?.getSwapSupportedChainsAndTokens();\n    setSwapSupportedChainsAndTokens(swapList ?? null);\n  }, [sdk, config?.network]);\n\n  const initializeNexus = async (provider: EthereumProvider) => {\n    setLoading(true);\n    try {\n      if (sdk.isInitialized()) throw new Error(\"Nexus is already initialized\");\n      await sdk.initialize(provider);\n      setNexusSDK(sdk);\n      const unifiedBalance = await sdk?.getUnifiedBalances(true);\n      setUnifiedBalance(unifiedBalance);\n      // Coinbase returns \"units per USD\" (e.g., 1 USD = 0.00028 ETH).\n      // Convert to \"USD per unit\" (e.g., 1 ETH = ~$3514) for straightforward UI calculations.\n      const rates = await sdk?.utils?.getCoinbaseRates();\n      const usdPerUnit: Record<string, number> = {};\n\n      for (const [symbol, value] of Object.entries(rates ?? {})) {\n        const unitsPerUsd = Number.parseFloat(String(value));\n        if (Number.isFinite(unitsPerUsd) && unitsPerUsd > 0) {\n          usdPerUnit[symbol.toUpperCase()] = 1 / unitsPerUsd;\n        }\n      }\n\n      for (const token of [\"ETH\", \"USDC\", \"USDT\"]) {\n        usdPerUnit[token] ??= 1;\n      }\n      setExchangeRate(usdPerUnit);\n      initChainsAndTokens();\n    } catch (error) {\n      console.error(\"Error initializing Nexus:\", error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const deinitializeNexus = async () => {\n    try {\n      if (!sdk.isInitialized()) throw new Error(\"Nexus is not initialized\");\n      await sdk.deinit();\n      setNexusSDK(null);\n      setSupportedChainsAndTokens(null);\n      setSwapSupportedChainsAndTokens(null);\n      setUnifiedBalance(null);\n      setExchangeRate(null);\n      setIntent(null);\n      setSwapIntent(null);\n      setAllowance(null);\n      setLoading(false);\n    } catch (error) {\n      console.error(\"Error deinitializing Nexus:\", error);\n    }\n  };\n\n  const attachEventHooks = () => {\n    sdk.setOnAllowanceHook((data: OnAllowanceHookData) => {\n      setAllowance(data);\n    });\n\n    sdk.setOnIntentHook((data: OnIntentHookData) => {\n      setIntent(data);\n    });\n\n    sdk.setOnSwapIntentHook((data: OnSwapIntentHookData) => {\n      setSwapIntent(data);\n    });\n  };\n\n  const handleInit = useCallback(\n    async (provider: EthereumProvider) => {\n      if (loading) {\n        return;\n      }\n      if (sdk.isInitialized()) {\n        console.log(\"Nexus already initialized\");\n        return;\n      }\n      if (!provider || typeof (provider as any).request !== \"function\") {\n        throw new Error(\"Invalid EIP-1193 provider\");\n      }\n      await initializeNexus(provider);\n      attachEventHooks();\n    },\n    [sdk, loading, initializeNexus]\n  );\n\n  const fetchUnifiedBalance = async () => {\n    try {\n      const unifiedBalance = await sdk?.getUnifiedBalances(true);\n      setUnifiedBalance(unifiedBalance);\n    } catch (error) {\n      console.error(\"Error fetching unified balance:\", error);\n    }\n  };\n\n  function getFiatValue(amount: number, token: string) {\n    const key = token.toUpperCase();\n    const rate = Number.parseFloat(String(exchangeRate?.[key] ?? \"0\"));\n    const isValid = Number.isFinite(amount) && Number.isFinite(rate);\n    const approx = isValid ? rate * amount : 0;\n\n    return approx.toFixed(3);\n  }\n\n  const handleNexusError: NexusContextType[\"handleNexusError\"] = (err) => {\n    if (err instanceof NexusError) {\n      const { code, message, data } = err;\n      return {\n        code,\n        message,\n        context: data?.context,\n        details: data?.details ?? undefined,\n      };\n    }\n    return { message: (err as Error)?.message || \"Unexpected error\" };\n  };\n\n  const value = useMemo(\n    () => ({\n      nexusSDK,\n      initializeNexus,\n      deinitializeNexus,\n      attachEventHooks,\n      intent,\n      setIntent,\n      allowance,\n      setAllowance,\n      handleInit,\n      supportedChainsAndTokens,\n      swapSupportedChainsAndTokens,\n      unifiedBalance,\n      network: config?.network,\n      loading,\n      fetchUnifiedBalance,\n      swapIntent,\n      setSwapIntent,\n      handleNexusError,\n      exchangeRate,\n      getFiatValue,\n    }),\n    [\n      nexusSDK,\n      initializeNexus,\n      deinitializeNexus,\n      attachEventHooks,\n      intent,\n      setIntent,\n      allowance,\n      setAllowance,\n      handleInit,\n      supportedChainsAndTokens,\n      swapSupportedChainsAndTokens,\n      unifiedBalance,\n      config,\n      loading,\n      fetchUnifiedBalance,\n      swapIntent,\n      setSwapIntent,\n      handleNexusError,\n      exchangeRate,\n      getFiatValue,\n    ]\n  );\n  return (\n    <NexusContext.Provider value={value}>{children}</NexusContext.Provider>\n  );\n};\n\nexport function useNexus() {\n  const context = useContext(NexusContext);\n  if (!context) {\n    throw new Error(\"useNexus must be used within a NexusProvider\");\n  }\n  return context;\n}\n\nexport default NexusProvider;\n",
      "type": "registry:component",
      "target": "components/nexus/NexusProvider.tsx"
    }
  ]
}