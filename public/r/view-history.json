{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "view-history",
  "type": "registry:component",
  "title": "View History",
  "description": "A simple component built with Nexus to display view history",
  "dependencies": [
    "lucide-react",
    "@radix-ui/react-dialog",
    "@radix-ui/react-label",
    "@radix-ui/react-slot"
  ],
  "registryDependencies": [
    "https://elements.nexus.availproject.org/r/badge.json",
    "https://elements.nexus.availproject.org/r/dialog.json",
    "https://elements.nexus.availproject.org/r/nexus-provider.json",
    "https://elements.nexus.availproject.org/r/separator.json",
    "https://elements.nexus.availproject.org/r/button.json",
    "https://elements.nexus.availproject.org/r/utils.json",
    "https://elements.nexus.availproject.org/r/card.json"
  ],
  "files": [
    {
      "path": "registry/nexus-elements/view-history/view-history.tsx",
      "content": "\"use client\";\n\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTrigger,\n  DialogTitle,\n} from \"@/registry/nexus-elements/ui/dialog\";\nimport { Clock, LoaderPinwheel, SquareArrowOutUpRight } from \"lucide-react\";\nimport { TOKEN_METADATA, type RFF } from \"@avail-project/nexus-core\";\nimport { cn } from \"@/lib/utils\";\nimport { Badge } from \"@/registry/nexus-elements/ui/badge\";\nimport { Button } from \"@/registry/nexus-elements/ui/button\";\nimport { Card } from \"@/registry/nexus-elements/ui/card\";\nimport { Separator } from \"@/registry/nexus-elements/ui/separator\";\nimport useViewHistory from \"./hooks/useViewHistory\";\n\nconst SourceChains = ({ sources }: { sources: RFF[\"sources\"] }) => {\n  return (\n    <div className=\"flex items-center\">\n      {sources.map((source, index) => (\n        <div\n          key={source.chain.id}\n          className={cn(\n            \"rounded-full transition-transform hover:scale-110\",\n            index > 0 && \"-ml-2\"\n          )}\n          style={{ zIndex: sources.length - index }}\n        >\n          <img\n            src={source.chain.logo}\n            alt={source.chain.name}\n            width={24}\n            height={24}\n            className=\"rounded-full\"\n          />\n        </div>\n      ))}\n    </div>\n  );\n};\n\nconst StatusBadge = ({ status }: { status: string }) => {\n  const getVariant = (status: string) => {\n    if (status === \"Fulfilled\") {\n      return \"default\";\n    } else if (status === \"Deposited\") {\n      return \"secondary\";\n    } else if (status === \"Refunded\") {\n      return \"outline\";\n    } else if (status === \"Failed\") {\n      return \"destructive\";\n    } else {\n      return \"default\";\n    }\n  };\n\n  return (\n    <Badge variant={getVariant(status)} className=\"px-3 py-1\">\n      <p className=\"text-xs font-semibold tracking-wide\">{status}</p>\n    </Badge>\n  );\n};\n\nconst DestinationToken = ({\n  destination,\n}: {\n  destination: RFF[\"destinations\"];\n}) => {\n  return (\n    <div className=\"flex items-center\">\n      {destination.map((dest, index) => (\n        <div\n          key={dest.token.symbol}\n          className={cn(\n            \"rounded-full transition-transform hover:scale-110\",\n            index > 0 && \"-ml-2\"\n          )}\n          style={{ zIndex: destination.length - index }}\n        >\n          <img\n            src={TOKEN_METADATA[dest.token.symbol].icon || \"/placeholder.svg\"}\n            alt={TOKEN_METADATA[dest.token.symbol].name}\n            width={24}\n            height={24}\n            className=\"rounded-full\"\n          />\n        </div>\n      ))}\n    </div>\n  );\n};\n\nconst ViewHistory = ({\n  viewAsModal = true,\n  className,\n}: {\n  viewAsModal?: boolean;\n  className?: string;\n}) => {\n  const {\n    history,\n    displayedHistory,\n    hasMore,\n    isLoadingMore,\n    getStatus,\n    observerTarget,\n    ITEMS_PER_PAGE,\n    formatExpiryDate,\n  } = useViewHistory();\n\n  const renderHistoryContent = () => {\n    if (displayedHistory.length > 0) {\n      return (\n        <>\n          {displayedHistory.map((pastIntent) => (\n            <Card\n              key={pastIntent.id}\n              className=\"p-4 hover:shadow-md transition-shadow duration-200 border-border/50 gap-3\"\n            >\n              <div className=\"flex items-start justify-between gap-4\">\n                <div className=\"flex items-center gap-3\">\n                  <DestinationToken destination={pastIntent.destinations} />\n                  <div className=\"flex flex-col\">\n                    <p className=\"text-sm font-medium\">\n                      {pastIntent.destinations\n                        .map((d) => d.token.symbol)\n                        .join(\", \")}\n                    </p>\n                    <p className=\"text-xs text-muted-foreground\">\n                      Intent #{pastIntent.id}\n                    </p>\n                  </div>\n                </div>\n                <StatusBadge status={getStatus(pastIntent)} />\n              </div>\n\n              <Separator className=\"my-1\" />\n\n              <div className=\"flex flex-col sm:flex-row  items-start sm:items-center justify-between gap-4\">\n                <div className=\"flex items-center justify-between gap-x-3 flex-1 w-full sm:min-w-fit\">\n                  <SourceChains sources={pastIntent.sources} />\n                  <div className=\"flex items-center gap-2 text-muted-foreground\">\n                    <div className=\"h-px w-8 bg-border\" />\n                    <span className=\"text-xs\">â†’</span>\n                    <div className=\"h-px w-8 bg-border\" />\n                  </div>\n                  <div className=\"rounded-full hover:scale-110\">\n                    <img\n                      src={\n                        pastIntent.destinationChain.logo || \"/placeholder.svg\"\n                      }\n                      alt={pastIntent.destinationChain.name}\n                      width={24}\n                      height={24}\n                      className=\"rounded-full\"\n                    />\n                  </div>\n                </div>\n\n                <div className=\"flex items-center justify-between sm:justify-end  gap-x-2 w-full\">\n                  <div className=\"text-left sm:text-right\">\n                    <p className=\"text-xs text-muted-foreground\">Expiry</p>\n                    <p className=\"text-xs font-medium\">\n                      {formatExpiryDate(pastIntent.expiry)}\n                    </p>\n                  </div>\n                  <a\n                    href={pastIntent.explorerUrl}\n                    target=\"_blank\"\n                    rel=\"noreferrer\"\n                  >\n                    <Button variant=\"outline\" size=\"icon\">\n                      <SquareArrowOutUpRight className=\"size-4\" />\n                    </Button>\n                  </a>\n                </div>\n              </div>\n            </Card>\n          ))}\n\n          {hasMore && (\n            <div ref={observerTarget} className=\"flex justify-center py-4\">\n              {isLoadingMore && (\n                <div className=\"flex items-center gap-2 text-muted-foreground\">\n                  <LoaderPinwheel className=\"size-4 animate-spin\" />\n                  <span className=\"text-sm\">Loading more...</span>\n                </div>\n              )}\n            </div>\n          )}\n\n          {!hasMore && displayedHistory.length > ITEMS_PER_PAGE && (\n            <div className=\"flex justify-center py-4\">\n              <p className=\"text-sm text-muted-foreground\">\n                No more transactions to load\n              </p>\n            </div>\n          )}\n        </>\n      );\n    }\n\n    if (history === null) {\n      return (\n        <div className=\"flex flex-col items-center justify-center py-16 gap-4\">\n          <div className=\"relative\">\n            <div className=\"absolute inset-0 bg-primary/10 blur-xl rounded-full\" />\n            <LoaderPinwheel className=\"relative animate-spin size-12 text-primary\" />\n          </div>\n          <div className=\"text-center space-y-1\">\n            <p className=\"text-base font-medium\">Loading your history</p>\n            <p className=\"text-sm text-muted-foreground\">\n              Fetching your past transactions...\n            </p>\n          </div>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"flex flex-col items-center justify-center py-16 gap-4\">\n        <Clock className=\"size-16 text-muted-foreground/30\" />\n        <div className=\"text-center space-y-1\">\n          <p className=\"text-base font-medium\">No history yet</p>\n          <p className=\"text-sm text-muted-foreground\">\n            Your transaction history will appear here\n          </p>\n        </div>\n      </div>\n    );\n  };\n\n  if (!viewAsModal) {\n    return (\n      <div className=\"flex flex-col gap-y-3 max-h-96 no-scrollbar overflow-y-auto w-full max-w-md\">\n        {renderHistoryContent()}\n      </div>\n    );\n  }\n\n  return (\n    <Dialog>\n      <DialogTrigger asChild>\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          className={cn(\"relative group\", className)}\n        >\n          <Clock className=\"size-5 text-primary transition-transform group-hover:scale-110\" />\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"max-w-2xl flex flex-col\">\n        <DialogHeader>\n          <DialogTitle className=\"text-2xl font-semibold\">\n            Transaction History\n          </DialogTitle>\n        </DialogHeader>\n        <div className=\"flex flex-col gap-y-3 max-h-96 no-scrollbar overflow-y-auto w-full\">\n          {renderHistoryContent()}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nexport default ViewHistory;\n",
      "type": "registry:component",
      "target": "components/view-history/view-history.tsx"
    },
    {
      "path": "registry/nexus-elements/view-history/hooks/useViewHistory.ts",
      "content": "import { type RFF } from \"@avail-project/nexus-core\";\nimport { useNexus } from \"../../nexus/NexusProvider\";\nimport { useCallback, useEffect, useState } from \"react\";\n\nconst ITEMS_PER_PAGE = 10;\n\nfunction formatExpiryDate(timestamp: number) {\n  const date = new Date(timestamp * 1000);\n  const formatted = date.toLocaleString(\"en-US\", {\n    month: \"short\",\n    day: \"2-digit\",\n    year: \"numeric\",\n  });\n  return formatted.replace(\" \", \", \");\n}\n\nconst useViewHistory = () => {\n  const { nexusSDK } = useNexus();\n  const [history, setHistory] = useState<RFF[] | null>(null);\n  const [displayedHistory, setDisplayedHistory] = useState<RFF[]>([]);\n  const [page, setPage] = useState(0);\n  const [hasMore, setHasMore] = useState(true);\n  const [isLoadingMore, setIsLoadingMore] = useState(false);\n  const [sentinelNode, setSentinelNode] = useState<HTMLDivElement | null>(null);\n\n  const observerTarget = useCallback((node: HTMLDivElement | null) => {\n    setSentinelNode(node);\n  }, []);\n\n  const fetchIntentHistory = async () => {\n    try {\n      const history = await nexusSDK?.getMyIntents();\n      if (history) {\n        setHistory(history);\n        const firstPage = history.slice(0, ITEMS_PER_PAGE);\n        setDisplayedHistory(firstPage);\n        setHasMore(history.length > ITEMS_PER_PAGE);\n      }\n    } catch (error) {\n      console.error(\"Error fetching intent history:\", error);\n    }\n  };\n\n  useEffect(() => {\n    if (!history) {\n      fetchIntentHistory();\n    }\n  }, [history]);\n\n  const loadMore = useCallback(() => {\n    if (!history || isLoadingMore || !hasMore) return;\n    setIsLoadingMore(true);\n\n    setTimeout(() => {\n      const nextPage = page + 1;\n      const startIndex = nextPage * ITEMS_PER_PAGE;\n      const endIndex = startIndex + ITEMS_PER_PAGE;\n      const newItems = history.slice(startIndex, endIndex);\n\n      if (newItems.length > 0) {\n        setDisplayedHistory((prev) => [...prev, ...newItems]);\n        setPage(nextPage);\n        setHasMore(endIndex < history.length);\n      } else {\n        setHasMore(false);\n      }\n\n      setIsLoadingMore(false);\n    }, 300);\n  }, [history, page, isLoadingMore, hasMore]);\n\n  useEffect(() => {\n    if (!sentinelNode) {\n      return;\n    }\n\n    const rootElement = sentinelNode.parentElement;\n\n    const observer = new IntersectionObserver(\n      (entries) => {\n        if (entries[0].isIntersecting && hasMore && !isLoadingMore) {\n          loadMore();\n        }\n      },\n      { threshold: 0.1, root: rootElement ?? null }\n    );\n\n    observer.observe(sentinelNode);\n\n    return () => {\n      observer.disconnect();\n    };\n  }, [sentinelNode, loadMore, hasMore, isLoadingMore, displayedHistory.length]);\n\n  const getStatus = (pastIntent: RFF) => {\n    if (pastIntent?.fulfilled) {\n      return \"Fulfilled\";\n    } else if (pastIntent?.deposited) {\n      return \"Deposited\";\n    } else if (pastIntent?.refunded) {\n      return \"Refunded\";\n    } else {\n      return \"Failed\";\n    }\n  };\n\n  return {\n    history,\n    displayedHistory,\n    page,\n    hasMore,\n    isLoadingMore,\n    getStatus,\n    observerTarget,\n    ITEMS_PER_PAGE,\n    formatExpiryDate,\n  };\n};\n\nexport default useViewHistory;\n",
      "type": "registry:component",
      "target": "components/view-history/hooks/useViewHistory.ts"
    }
  ]
}